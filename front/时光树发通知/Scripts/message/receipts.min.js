$(function () { function d(a, b) { var c = function (a) { return a += "", a.replace(/^(\d)$/, "0$1") }, d = ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"], e = { yyyy: a.getFullYear(), yy: a.getFullYear().toString().substring(2), M: a.getMonth() + 1, MM: c(a.getMonth() + 1), d: a.getDate(), dd: c(a.getDate()), hh: c(a.getHours() % 12), HH: c(a.getHours()), mm: c(a.getMinutes()), ss: c(a.getSeconds()), w: d[a.getDay()] }; return b || (b = "yyyy-MM-dd HH:mm:ss"), b.replace(/([a-z])(\1)*/gi, function (a) { return e[a] }) } function i(c) { $.ajax({ url: "/message/ReceiptData", data: { aftertime: document.querySelector("#aftertime").value, uid: document.querySelector("#uid").value }, success: function (c) { return c[0] && 0 != c.length ? (b.messages = b.messages.concat(c), document.querySelector("#aftertime").value = c[c.length - 1].writetime, this.messages = b.messages, setTimeout(function () { a.update().check().handlers(!0) }, 10), void 0) : (this.nomore = !0, void 0) }.bind(c), complete: function () { this.getting = !1 }.bind(c) }) } var e, f, g, h, a = Layzr({ normal: "data-src", threshold: 10 }), b = { messages: [] }, c = { taskid: 0, kid: document.querySelector("#kid").value, messagetype: 1, state: 1 }; Vue.component("Msg", { template: "#msg", props: ["message"], methods: { detail: function (a, b, c) { zyapp().com.newWindow("/message/message?uid=" + document.querySelector("#uid").value + "&kid=" + document.querySelector("#uid").value + "&role=" + document.querySelector("#role").value + "&taskid=" + a + "&messagetype=" + b + "&state=" + c) }, receiver: function (a, b, d) { c = { kid: c.kid, taskid: a, messagetype: b, state: d }, h.go({ name: "receiver" }) } } }), Vue.component("MsgImg", { template: "#msg-img", props: ["imgs"], methods: { show: function (a) { var c, b = []; for (c = 0; c < this.imgs.length; c++) b.push(this.imgs[c].url); zyapp().com.showImgs(b[a], b, a) } } }), Vue.component("MsgAudio", { template: "#msg-audio", data: function () { return { length: "", playing: !1 } }, props: ["audio"], methods: { play: function () { var a = this.$el.querySelector("audio"); this.playing ? (a.pause(), a.currentTime = 0) : a.play(), this.playing = !this.playing }, ended: function () { var a = this.$el.querySelector("audio"); a.pause(), a.currentTime = 0, this.playing = !this.playing }, loadedmetadata: function () { var a = this.$el.querySelector("audio"), b = parseInt(a.duration); this.length = b ? b + '"' : "&nbsp;" }, loaderror: function () { this.audio = "", this.length = "" } } }), Vue.component("MsgVideo", { template: "#msg-video", props: ["video"], methods: { play: function () { zyapp().com.playVideo(this.video) } } }), Vue.component("SelectList", { template: "#select-list", props: ["groups"], data: function () { }, methods: { toggle: function (a) { this.groups[a].open = !this.groups[a].open } } }), Vue.filter("dateformat2", function (a) { return d(new Date(a.replace(/-/g, "/")), "M月d日") }), Vue.filter("dateformat", function (a) { var b = new Date, c = new Date(b.getTime() - 864e5); return a.indexOf(d(b, "yyyy-MM-dd")) >= 0 ? d(new Date(a.replace(/-/g, "/")), "HH:mm:ss") : a.indexOf(d(c, "yyyy-MM-dd")) >= 0 ? "昨天 " + d(new Date(a.replace(/-/g, "/")), "HH:mm:ss") : d(new Date(a.replace(/-/g, "/")), "yyyy-MM-dd HH:mm:ss") }), Vue.filter("dateformat3", function (a) { return d(new Date(a.replace(/-/g, "/")), "yyyy-MM-dd HH:mm") }), e = Vue.extend({ template: "#main", data: function () { return { messages: [], getting: !1, nomore: !1 } }, methods: { getmore: function (b) { a.update().check().handlers(!0); var c = b.target; c.scrollTop + c.clientHeight + 50 > c.scrollHeight && !this.getting && !this.nomore && (this.getting = !0, i(this)) } }, ready: function () { i(this) } }), f = Vue.extend({ template: "#selector", data: function () { return { read: [], unread: [], tab: "read" } }, methods: { shift: function (a) { this.tab = a } }, route: { data: function () { $.ajax({ url: "/message/GetReceivers", data: JSON.parse(JSON.stringify(c)), success: function (a) { this.read = a.read, this.unread = a.unread, 0 == this.read.length && this.unread.length > 0 && (this.tab = "unread") }.bind(this) }) }, activate: function () { document.querySelector(".content").style.overflow = "hidden" }, deactivate: function () { document.querySelector(".content").style.overflow = "auto" } } }), g = Vue.extend({}), h = new VueRouter, h.map({ "/": { component: e, subRoutes: { "/receiver": { name: "receiver", component: f } } } }), h.start(g, "#app") });